### 헥사고날 아키텍처 (1)

- 테스트는 품질 보증을 위한 도구이기도 하지만 설계를 위한 도구이기도 하다.

- 테스트하기 쉬운 코드가 좋은 코드일 확률이 높다.

- 아키텍처란? 어떤 비즈니스 문제를 해결하기 위해, 준수해야하는 제약을 넣는 과정

    - 꼭 사용해야할 이유가 없다면 없는 게 나을 수도 있다.

    - 문제에 대한 공감을 이끌어 내고 제약을 넣어야 하는 이유를 느낄 수 있어야 한다.

- 아키텍처는 명쾌한 해답이 있는 게 아니라, 비즈니스 문제를 계속 탐구하고 어떻게 해결할 것인지 방향성을 정할 수 있어야 한다.

**아키텍트의 목표**

- 시스템이 동시 작업이 되어야 함 -> 관심사가 분리 되어야 함 -> 경계를 나누어야 함

    - 의존성 역전은 대표적인 경계를 만드는 방법 중 하나이다.

    - 인적 자원을 절감할 수 있게 되어야 한다.

- 정책을 만들고 세부사항을 미루는 시스템을 개발해야 한다.

    - DB, WebServer, REST, Framework가 중요한 것이 아니다.

    - 도메인이 먼저 개발되어야 한다.

    - 소프트웨어의 핵심은 도메인이다.

***의존성 역전***

의존성 역전은 포트-어댑터 패턴이다.

- 실행 객체는 인터페이스(포트)에 필요한 연결된 객체(어댑터)를 꽂아주는 느낌이다.

- 포트를 통해 의존하는 객체들은 어댑터이다.

Input Adaptor -> Input Port (interface) <- ServiceImpl -> OutputPort (interface) <- Output Adaptor

Controller -> Service (interface) <- ServiceImpl -> Repository (interface) <- Repository

Domain은 ServiceImpl과 연결되어 있음.

***헥사고날 아키텍처 장점***

- 외부에서 도메인으로 향하는 방향이 단방향으로 유지된다.

- 외부 세계에는 관심이 없다. 도메인에 충실할 수 있다.
    
    - Spring Framework를 사용할지, JPA를 사용할지는 관심이 없다.

- 테스트에 유리하다.

클린 아키텍처는와 헥사고날 아키텍처는 같은 이야기이다.

- Input Port는 UseCase, Output Port는 Gateway를 사용한다.

- 그 외 외부세계는 관심이 없어서 Humble로 부른다.

### 헥사고날 아키텍처 (2)

- 레이어드 아키텍처는 DB 위주의 사고, 설계를 하게 된다.

- 헥사고날은 Domain에 집중하고 외부세계는 그 아키텍처에 얹혀질 뿐이다.

우리가 짜는 코드도 스프링 프레임워크에 의존적이지 않은지 의심해야 한다.

    - 새로운 프레임워크에 변경하려면 도메인만을 추출하여 이식할 수 있어야 한다. 

모델에 대한 세분화는 정답이 없다.

- 그러나, 모델은 구분해야 한다. RequestDTO도 별도로 두어야 할 것이고, Jpadomain의 값이 ResponseDTO에 들어가지 않아야 할 경우가 있다.

- 구분하지 않으면 도메인이 DB에 종속된다. JPA 어노테이션에 의존적이게 되면 도메인에 RDB 사용, JPA 로딩전략 등을 사용하고 의존하기 때문이다.

- RequestDTO가 -> Service에 의존하면 순환참조가 발생할 수 있음 UseCase와 Service를 받아줘야 할 DTO가 필요

- 위는 Gateway도 마찬가지이다.

많은 모델이 생기면 불편해질 수도 있다. 원칙과 편의성, 이 둘 사이에서 우리 프로젝트에 맞는 전략을 사용해야 한다.

도메인 모델 만큼은 프레임워크나 라이브러리에 종속되지 않는 순수한 상태였으면 좋겠다.

